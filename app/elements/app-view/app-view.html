<polymer-element name="app-view" constructor="AppView" attributes="requireDrawer, requireSearch">
  <template>
    <link rel="stylesheet" href="app-view.css">
    <style type="text/css">
      :host #main_content post-list{
        padding-bottom: {{post_list_bottom}};
      }
    </style>
    <core-drawer-panel disableEdgeSwipe="!requireDrawer" disableSwipe="!requireDrawer">
      <core-header-panel style="z-index:5;" drawer>
        <core-toolbar class="tall" id="drawer_toolbar">
          <div horizontal layout center flex>
            <div flex three>
              <span>User Name</span>
            </div>
            <div flex two end-justified horizontal layout>
              <core-image class="avatar" src="http://lorempixel.com/60/60"></core-image>
            </div>
          </div>
        </core-toolbar>
        <core-menu valueattr="label" id="core_menu" theme="core-light-theme">
          <core-item label="Logout" icon="settings" horizontal center layout></core-item>
        </core-menu>
      </core-header-panel>
      <core-header-panel main>
        <core-toolbar id="main_toolbar">
          <template if="requireDrawer">
            <core-icon-button icon="menu" core-drawer-toggle></core-icon-button>
          </template>
          <div flex horizontal center-justified layout end>{{screen_title}}</div>
          <template if="requireSearch">
            <core-icon-button id="searchModalBtn" icon="search" theme="core-light-theme" on-tap="{{openSearchModal}}"></core-icon-button>
          </template>
        </core-toolbar>

        <div id="main_content" layout vertical>
          <div horizontal layout flex>
            <core-pages selected="{{selectedTab}}">
              <div>
                <core-header-panel mode="cover" flex>
                  <div horizontal center-justified layout>
                    <post-list count="{{foodCount}}" type="food"></post-list>
                  </div>
                </core-header-panel>
              </div>
              <div>
                <core-header-panel mode="cover" flex>
                  <div horizontal center-justified layout>
                    <post-list count="{{restaurantCount}}" type="restaurant"></post-list>
                  </div>
                </core-header-panel>
              </div>
              <div>
                <core-header-panel mode="cover" flex>
                  <div horizontal center-justified layout>
                    <post-list count="{{couponCount}}" type="coupon"></post-list>
                  </div>
                </core-header-panel>
              </div>
            </core-pages>
          </div>
          <div id="main_tabs">
            <paper-tabs selected="{{selectedTab}}">
              <paper-tab>
                <core-icon-button icon="maps:local-pizza"></core-icon-button>
              </paper-tab>
              <paper-tab>
                <core-icon-button icon="room"></core-icon-button>
              </paper-tab>
              <paper-tab>
                <core-icon-button icon="loyalty"></core-icon-button>
              </paper-tab>
            </paper-tabs>
          </div>
        </div>
      </core-header-panel>
    </core-drawer-panel>
  </template>
  <script>
    (function () {
      Polymer({
        publish: {
          selectedTab: 0,
          post_list_bottom: '40px',
          screen_title: '',
          requireDrawer: false,
          requireSearch: false,
        },
        created: function()
        {
        },
        attached: function()
        {
          setTimeout(function()
          {
            try{
              var t = new Trianglify({
                x_gradient: Trianglify.colorbrewer.PuOr[9],
                noiseIntensity: 0,
                cellsize: 90
              });
              var pt = t.generate(500, 500);

              this.$.drawer_toolbar.style.backgroundImage = pt.dataUrl;
            }catch(e)
            {
              
            }

          }.bind(this), 1500);
          
          this.selectedTabChanged();
        },
        selectedTabChanged: function()
        {
          switch(this.selectedTab)
          {
            default:
              this.screen_title = 'Food';
            break;
            case 1:
              this.screen_title = 'Restaurant';
            break;
            case 2:
              this.screen_title = 'Coupon';
            break;

            console.log('screen_title', this.screen_title);
          }
        },
        openSearchModal: function(event, detail, sender)
        {
          console.log('opening... Search Modal');

          var el = new SearchModalTransparent();
          el.screen_title = 'Search';
          xdPrepend(document.body, el);
        }
      });
    })();
  </script>
</polymer-element>
